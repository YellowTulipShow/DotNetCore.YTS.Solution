<!-- <div class="easyui-form form_label_120" data-options="novalidate:true"> -->
<div class="easyui-panel winBody" data-options="border: false, novalidate:true">
    <div class="form_item">
        <label for="dialog_ManagerID">管理员选择:</label>
        <input id="dialog_ManagerID" type="text" class="easyui-combogrid"
               toolbar="#toolbar_dialog_ManagerID"
               data-options="
                panelWidth:800,
                panelHeight:500,
                url:Api.UrlFormat('/api/Managers/GetManagersList'),
                delay: 100,
                editable:false,
                mode:'remote',
                pageSize:10,
                pageList:[10,20,30,40,50],
                pagination:true,
                sortName:'ID',
                sortOrder:'desc',
                method:'get',
                queryParams:{
                    Phone: $('#toolbar_dialog_ManagerID_Phone').val(),
                },
                idField:'ID',
                textField:'Phone',
                columns:[[
                    {field:'ID',title:'ID',hidden:true,width:50,sortable:true},
                    {field:'Account',title:'账号',width:150},
                    {field:'TrueName',title:'真实姓名',width:150},
                    {field:'NickName',title:'昵称',width:100},
                    {field:'Phone',title:'电话',width:100},
                ]],
                onClickRow:function(index,row){
                    if (row) {
                        var ManagerName = row.Name ? row.Name : row.NickName;
                        $('#dialog_ManagerName').textbox('setValue', ManagerName);
                    }
                }" />
        <div id="toolbar_dialog_ManagerID">
            <label>管理员电话：</label>
            <input id="toolbar_dialog_ManagerID_Phone" class="easyui-textbox" style="width: 150px;" type="text">
            <button type="button" class="easyui-linkbutton" style="height: 28px;" iconcls="icon-zoom"
                    onclick="$('#dialog_ManagerID').combogrid('grid').datagrid('load',{
                        Phone: $('#toolbar_dialog_ManagerID_Phone').val(),
                    })">
                搜索
            </button>
            <button type="button" class="easyui-linkbutton" style="height: 28px; float: right;" iconcls="icon-remove"
                    onclick="$('#dialog_ManagerID').combogrid('setValue', '');$('#dialog_ManagerID').combogrid('hidePanel')">
                清除
            </button>
        </div>
    </div>
    <div class="form_item">
        <label for="dialog_UserID">用户选择:</label>
        <input id="dialog_UserID" type="text" class="easyui-combogrid"
               toolbar="#toolbar_dialog_UserID"
               data-options="
                panelWidth:800,
                panelHeight:500,
                url:Api.UrlFormat('/api/Users/GetUsersList'),
                delay: 100,
                editable:false,
                mode:'remote',
                pageSize:10,
                pageList:[10,20,30,40,50],
                pagination:true,
                sortName:'ID',
                sortOrder:'desc',
                method:'get',
                queryParams:{
                    Phone: $('#toolbar_dialog_UserID_Phone').val(),
                },
                idField:'ID',
                textField:'Phone',
                columns:[[
                    {field:'ID',title:'ID',hidden:true,width:50,sortable:true},
                    {field:'Account',title:'账号',width:150},
                    {field:'Name',title:'真实姓名',width:150},
                    {field:'NickName',title:'昵称',width:100},
                    {field:'Money',title:'账户余额',width:100},
                    {field:'Phone',title:'电话',width:100},
                    {field:'WeChatNumber',title:'微信',width:100},
                    {field:'QQ',title:'QQ号',width:100},
                    {field:'Address',title:'联系地址',width:100},
                ]],
                onClickRow:function(index,row){
                    if (row) {
                        var UserName = row.Name ? row.Name : row.NickName;
                        $('#dialog_UserName').textbox('setValue', UserName);
                    }
                }" />
        <div id="toolbar_dialog_UserID">
            <label>用户电话：</label>
            <input id="toolbar_dialog_UserID_Phone" class="easyui-textbox" style="width: 150px;" type="text">
            <button type="button" class="easyui-linkbutton" style="height: 28px;" iconcls="icon-zoom"
                    onclick="$('#dialog_UserID').combogrid('grid').datagrid('load',{
                        Phone: $('#toolbar_dialog_UserID_Phone').val(),
                    })">
                搜索
            </button>
            <button type="button" class="easyui-linkbutton" style="height: 28px; float: right;" iconcls="icon-remove"
                    onclick="$('#dialog_UserID').combogrid('setValue', '');$('#dialog_UserID').combogrid('hidePanel')">
                清除
            </button>
        </div>
    </div>
    <div class="form_item">
        <label for="dialog_ProductID">产品选择:</label>
        <input id="dialog_ProductID" type="text" class="easyui-combogrid"
               toolbar="#toolbar_dialog_ProductID"
               data-options="
                multiple: true,
                panelWidth:600,
                panelHeight:500,
                url:Api.UrlFormat('/api/Product/GetProductList'),
                delay: 100,
                editable:false,
                mode:'remote',
                pageSize:10,
                pageList:[10,20,30,40,50],
                pagination:true,
                sortName:'ID',
                sortOrder:'desc',
                method:'get',
                queryParams:{
                    Name: $('#toolbar_dialog_ProductID_Name').val(),
                },
                idField:'ID',
                textField:'Name',
                columns:[[
                    {field:'ck',checkbox:true,width:60},
                    {field:'ID',title:'ID',hidden:true,width:50,sortable:true},
                    {field:'Name',title:'产品名称',width:150},
                    {field:'Price',title:'产品价格',width:100},
                    {field:'Number',title:'产品数量',width:100},
                    {field:'IsUnlimitedNumber',title:'是否无限数量',width:100,formatter:function(val,row){return val == true ? '是' : '否';}},
                    {field:'IsPhysicalEntity',title:'是否实物产品',width:100,formatter:function(val,row){return val == true ? '是' : '否';}},
                ]],
                onSelect:function(rowIndex, row){
                }" />
        <div id="toolbar_dialog_ProductID">
            <label>产品名称：</label>
            <input id="toolbar_dialog_ProductID_Name" class="easyui-textbox" style="width: 150px;" type="text">
            <button type="button" class="easyui-linkbutton" style="height: 28px;" iconcls="icon-zoom"
                    onclick="$('#dialog_ProductID').combogrid('grid').datagrid('load',{
                        Name: $('#toolbar_dialog_ProductID_Name').val(),
                    })">
                搜索
            </button>
            <button type="button" class="easyui-linkbutton" style="height: 28px;" iconcls="icon-ok"
                    onclick="$('#dialog_ProductID').combogrid('hidePanel');InitProductForms();">
                确认
            </button>
            <button type="button" class="easyui-linkbutton" style="height: 28px; float: right;" iconcls="icon-remove"
                    onclick="$('#dialog_ProductID').combogrid('setValue', '');$('#dialog_ProductID').combogrid('hidePanel')">
                清除
            </button>
        </div>
    </div>
    <script type="text/javascript">
        var CreateProductFormIndex = 1;
        function InitProductForms() {
            CreateProductFormIndex = 1;
            var content = $('#IDDialogFormContent');
            content.html('');
            var managerRow = $('#dialog_ManagerID').combogrid('grid').datagrid('getSelected');
            var userRow = $('#dialog_UserID').combogrid('grid').datagrid('getSelected');
            var productRows = $('#dialog_ProductID').combogrid('grid').datagrid('getSelections');
            for (var i = 0; i < productRows.length; i++) {
                var productRow = productRows[i]
                console.log('productRow:', productRow);
                var html = CreateProductForm(managerRow, userRow, productRow);
                CreateProductFormIndex += 1;
                content.append(html);
                $.parser.parse("#IDDialogFormContent");
            }
        }
        function CreateProductForm(managerRow, userRow, productRow) {
            return window.PageInfo.RenderingHTML('#IDDialogFormTemplate', {
                "CreateProductFormIndex": CreateProductFormIndex,
                "ID": 0,
                "UserID": userRow.ID,
                "UserName": userRow.Name ? userRow.Name : userRow.NickName,
                "BatchNo": "",
                "ExpensesOrderNo": "",
                "ProductID": productRow.ID,
                "ProductName": productRow.Name,
                "ProductPrice": productRow.Price,
                "ProductBuyNumber": 0,
                "ProductExpensesMoney": 0,
                "ProductPayMoney": 0,
                "AddTime": "",
                "AddManagerID": managerRow.ID,
                "Remark": ""
            });
        }
    </script>
    <style type="text/css">
        .easyui-panel { border: 0; overflow: hidden; }
        .easyui-form { width: 400px; padding: 20px; border: 1px solid #c5c5c5; border-radius: 3px; overflow: hidden; display: block; float: left; margin: 0 20px 20px 0; }
        .form_item label { width: 150px; }
    </style>
</div>
<div id="IDDialogFormContent" class="easyui-panel" data-options="border: false, fit:true,"></div>
<script id="IDDialogFormTemplate" type="text/html">
    <form class="easyui-form form_label_130" data-options="novalidate:true">
        <input type="hidden" name="ID" value="[ID]" />
        <input type="hidden" name="BatchNo" value="[BatchNo]" />
        <input type="hidden" name="ExpensesOrderNo" value="[ExpensesOrderNo]" />
        <input type="hidden" name="AddTime" value="[AddTime]" />
        <input type="hidden" name="AddManagerID" value="[AddManagerID]" />
        <input type="hidden" name="UserName" value="[UserName]" />
        <input type="hidden" name="UserID" value="[UserID]" />
        <input type="hidden" name="ProductID" value="[ProductID]" />

        <div class="form_item">
            <label>用户名称:</label>
            <input id="dialog_UserName_[CreateProductFormIndex]" name="UserName" type="text" class="easyui-textbox" value="[UserName]" />
        </div>
        <div class="form_item">
            <label>产品名称:</label>
            <input id="dialog_ProductName_[CreateProductFormIndex]" name="ProductName" type="text" class="easyui-textbox" value="[ProductName]" />
        </div>
        <div class="form_item">
            <label>产品价格：</label>
            <input id="dialog_ProductPrice_[CreateProductFormIndex]" type="text" name="ProductPrice" class="easyui-numberbox" data-options="min:0,precision:2" value="[ProductPrice]" />
        </div>
        <div class="form_item">
            <label>产品购买数量：</label>
            <input id="dialog_ProductBuyNumber_[CreateProductFormIndex]" type="text" name="ProductBuyNumber" class="easyui-numberbox"
                data-options="
                min:0,
                precision:0,
                onChange: function(newValue, oldValue) {
                    var number = parseInt(newValue);
                    var price = $('#dialog_ProductPrice_[CreateProductFormIndex]').numberbox('getValue');
                    price = parseFloat(price);
                    var money = price * number;
                    $('#dialog_ProductExpensesMoney_[CreateProductFormIndex]').numberbox('setValue', money);
                    $('#dialog_ProductPayMoney_[CreateProductFormIndex]').numberbox('setValue', money);
                },
                " value="0" />
        </div>
        <div class="form_item">
            <label>产品消费金额：</label>
            <input id="dialog_ProductExpensesMoney_[CreateProductFormIndex]" type="text" name="ProductExpensesMoney" class="easyui-numberbox" data-options="min:0,precision:2" value="0" />
        </div>
        <div class="form_item">
            <label>实际购买支付金额：</label>
            <input id="dialog_ProductPayMoney_[CreateProductFormIndex]" type="text" name="ProductPayMoney" class="easyui-numberbox" data-options="min:0,precision:2" value="0" />
        </div>
        <div class="form_item">
            <label>备注:</label>
            <input id="dialog_Remark" name="Remark" type="text" class="easyui-textbox" />
        </div>
    </form>
</script>
